(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();const b={STARTER:{id:"starter",name:"èµ·æ­¥æœŸ",ageRange:[18,25],color:8900331},GROWTH:{id:"growth",name:"æˆé•¿æœŸ",ageRange:[26,35],color:10025880},PRIME:{id:"prime",name:"é»„é‡‘æœŸ",ageRange:[36,50],color:16766720},MATURE:{id:"mature",name:"æˆç†ŸæœŸ",ageRange:[51,65],color:16753920},RETIRE:{id:"retire",name:"é€€ä¼‘æœŸ",ageRange:[66,100],color:12632256}};function x(i){for(const t of Object.values(b))if(i>=t.ageRange[0]&&i<=t.ageRange[1])return t;return b.RETIRE}const I={STOCK:{id:"stock",name:"è‚¡ç¥¨æŠ•èµ„",icon:"ğŸ“Š",desc:"å­¦ä¹ æŠ€æœ¯åˆ†æã€åŸºæœ¬é¢åˆ†æã€ä»·å€¼æŠ•èµ„",relatedEvents:["è‚¡ç¥¨","è¯åˆ¸","Aè‚¡","æ¸¯è‚¡","ç¾è‚¡"]},FUND:{id:"fund",name:"åŸºé‡‘ç†è´¢",icon:"ğŸ“ˆ",desc:"å­¦ä¹ åŸºé‡‘é€‰æ‹©ã€å®šæŠ•ç­–ç•¥ã€èµ„äº§é…ç½®",relatedEvents:["åŸºé‡‘","å®šæŠ•","ETF","æŒ‡æ•°"]},REAL_ESTATE:{id:"real_estate",name:"æˆ¿äº§æŠ•èµ„",icon:"ğŸ ",desc:"å­¦ä¹ æˆ¿äº§åˆ†æã€ç§Ÿå”®æ¯”ã€åŸå¸‚é€‰æ‹©",relatedEvents:["æˆ¿äº§","ä¹°æˆ¿","ç§Ÿé‡‘","æ¥¼å¸‚"]},CRYPTO:{id:"crypto",name:"åŠ å¯†è´§å¸",icon:"â‚¿",desc:"å­¦ä¹ åŒºå—é“¾ã€DeFiã€äº¤æ˜“ç­–ç•¥",relatedEvents:["åŠ å¯†","BTC","ETH","å¸åœˆ","Web3"]},BUSINESS:{id:"business",name:"åˆ›ä¸šç»å•†",icon:"ğŸ¢",desc:"å­¦ä¹ å•†ä¸šæ¨¡å¼ã€ç®¡ç†ã€å¸‚åœºè¥é”€",relatedEvents:["åˆ›ä¸š","ç”Ÿæ„","å…¬å¸","åˆä¼™"]},CAREER:{id:"career",name:"èŒä¸šå‘å±•",icon:"ğŸ’¼",desc:"å­¦ä¹ èŒåœºæŠ€èƒ½ã€è·³æ§½è°ˆè–ªã€å‰¯ä¸š",relatedEvents:["èŒåœº","è·³æ§½","å‡èŒ","å‰¯ä¸š","å·¥èµ„"]}},k={MORTGAGE:{id:"mortgage",name:"æˆ¿è´·",icon:"ğŸ ",maxYears:30,interestRate:.04,maxRatio:.7},CAR_LOAN:{id:"car_loan",name:"è½¦è´·",icon:"ğŸš—",maxYears:5,interestRate:.05,maxRatio:.8},CONSUMER:{id:"consumer",name:"æ¶ˆè´¹è´·",icon:"ğŸ’³",maxYears:3,interestRate:.08,maxRatio:1}};function $(i,t){const e=Math.max(6e4,(i-18)*8e3+6e4);return{wealth:t,cash:t,income:e,monthlyExpense:5e3,insight:20+Math.floor(Math.random()*15)}}class g{constructor(){this.reset()}reset(t=25,e=1e5){const s=$(t,e);this.name="ç©å®¶",this.age=t,this.month=1,this.startingAge=t,this.startingWealth=e,this.stats={wealth:s.wealth,cash:s.cash,income:s.income,monthlyExpense:s.monthlyExpense,insight:s.insight},this.skills={},Object.keys(I).forEach(n=>{this.skills[n.toLowerCase()]=0}),this.life={married:!1,spouse:null,children:0,cars:[],houses:[]},this.loans=[],this.holdings=[],this.holdingIdCounter=0,this.passiveIncome=0,this.lifeLog=[],this.isAlive=!0,this.job="æ™®é€šä¸Šç­æ—"}getRemainingMonths(){return 13-this.month}spendTime(t){this.month+=t;for(let e=0;e<t;e++)this.processMonthlyExpenses()}processMonthlyExpenses(){this.stats.cash+=this.stats.income/12;let t=this.stats.monthlyExpense;t+=this.life.children*3e3,t+=this.life.cars.length*2e3,this.loans.forEach(e=>{e.monthsLeft>0&&(t+=e.monthlyPayment,e.monthsLeft--,e.remaining-=e.monthlyPayment-e.remaining*(e.interestRate/12),e.monthsLeft<=0&&(e.remaining=0))}),this.stats.cash-=t,this.stats.cash+=this.passiveIncome/12,this.updateMonthlyHoldingPrices()}updateMonthlyHoldingPrices(){this.holdings.forEach(t=>{const e=this.skills[t.type]||0,s=(Math.random()-.5)*.1,n=e/10*.003,a=s+n;t.currentPrice=Math.max(1,t.currentPrice*(1+a)),t.profit=(t.currentPrice-t.buyPrice)*t.shares,t.profitRate=(t.currentPrice-t.buyPrice)/t.buyPrice*100}),this.recalculateWealth()}nextYear(){return this.age++,this.month=1,this.updateAllHoldingPrices(),this.recalculateWealth(),this.loans=this.loans.filter(t=>t.monthsLeft>0),(this.age>=100||this.stats.cash<-1e6)&&(this.isAlive=!1),this.isAlive}recalculateWealth(){const t=this.holdings.reduce((a,o)=>a+o.shares*o.currentPrice,0),e=this.life.houses.reduce((a,o)=>a+o.currentValue,0),s=this.life.cars.reduce((a,o)=>a+o.currentValue,0),n=this.loans.reduce((a,o)=>a+o.remaining,0);this.stats.wealth=this.stats.cash+t+e+s-n}getCurrentStage(){return x(this.age)}study(t,e=100){const s=t.toLowerCase();if(this.skills[s]!==void 0){const n=this.skills[s],a=Math.max(1,Math.floor(e/20*(1-n/150)));return this.skills[s]=Math.min(100,n+a),this.stats.insight=Math.min(100,this.stats.insight+Math.floor(a/3)),a}return 0}getSkillLevel(t){return this.skills[t.toLowerCase()]||0}getTopSkill(){let t={field:null,level:0};for(const[e,s]of Object.entries(this.skills))s>t.level&&(t={field:e,level:s});return t}marry(t={}){return this.life.married?!1:(this.life.married=!0,this.life.spouse={name:t.name||"é…å¶",income:t.income||0},this.stats.income+=this.life.spouse.income,!0)}haveBaby(){return this.life.married?(this.life.children++,!0):!1}buyCar(t){const e={name:t.name||"æ±½è½¦",purchasePrice:t.price,currentValue:t.price,purchaseYear:this.age};return this.life.cars.push(e),e}buyHouse(t){const e={name:t.name||"æˆ¿äº§",purchasePrice:t.price,currentValue:t.price,purchaseYear:this.age,monthlyRent:t.rent||0,isRented:!1};return this.life.houses.push(e),e}takeLoan(t,e,s){const n=k[t.toUpperCase()];if(!n)return null;const a=n.interestRate/12,o=s*12,c=e*a*Math.pow(1+a,o)/(Math.pow(1+a,o)-1),l={type:n.id,typeName:n.name,principal:e,remaining:e,monthlyPayment:Math.round(c),monthsLeft:o,interestRate:n.interestRate};return this.loans.push(l),this.stats.cash+=e,l}getMonthlyExpense(){let t=this.stats.monthlyExpense;return t+=this.life.children*3e3,t+=this.life.cars.length*2e3,t+=this.loans.reduce((e,s)=>e+(s.monthsLeft>0?s.monthlyPayment:0),0),t}getTotalDebt(){return this.loans.reduce((t,e)=>t+e.remaining,0)}buyInvestment(t,e,s,n=100){if(this.stats.cash<s)return null;this.stats.cash-=s;const a=s/n,o={id:++this.holdingIdCounter,type:t,name:e,buyPrice:n,currentPrice:n,shares:a,amount:s,buyTime:{age:this.age,month:this.month},profit:0,profitRate:0};return this.holdings.push(o),this.recalculateWealth(),o}sellInvestment(t,e=1){const s=this.holdings.findIndex(d=>d.id===t);if(s===-1)return null;const n=this.holdings[s],a=n.shares*e,o=a*n.currentPrice,c=a*n.buyPrice,l=o-c,r=l/c*100;return this.stats.cash+=o,e>=1?this.holdings.splice(s,1):(n.shares-=a,n.amount=n.shares*n.buyPrice),this.recalculateWealth(),{cash:o,profit:l,profitRate:r}}addToPosition(t,e){if(this.stats.cash<e)return!1;const s=this.holdings.find(l=>l.id===t);if(!s)return!1;const n=e/s.currentPrice,o=s.shares*s.buyPrice+e,c=s.shares+n;return s.shares=c,s.buyPrice=o/c,s.amount=o,this.stats.cash-=e,this.recalculateWealth(),!0}updateHoldingPrice(t,e){(t?this.holdings.filter(n=>n.id===t):this.holdings).forEach(n=>{n.currentPrice*=1+e,n.profit=(n.currentPrice-n.buyPrice)*n.shares,n.profitRate=(n.currentPrice-n.buyPrice)/n.buyPrice*100}),this.recalculateWealth()}updateAllHoldingPrices(){this.holdings.forEach(t=>{const e=this.skills[t.type]||0,s=(Math.random()-.5)*.3,n=e/10*.01,a=s+n;t.currentPrice=Math.max(1,t.currentPrice*(1+a)),t.profit=(t.currentPrice-t.buyPrice)*t.shares,t.profitRate=(t.currentPrice-t.buyPrice)/t.buyPrice*100}),this.recalculateWealth()}getHoldingsValue(){return this.holdings.reduce((t,e)=>t+e.shares*e.currentPrice,0)}getHoldingsProfit(){return this.holdings.reduce((t,e)=>t+e.profit,0)}getHoldingsByType(){const t={};return this.holdings.forEach(e=>{t[e.type]||(t[e.type]={count:0,value:0,profit:0}),t[e.type].count++,t[e.type].value+=e.shares*e.currentPrice,t[e.type].profit+=e.profit}),t}applyEffect(t){if(t){for(const[e,s]of Object.entries(t))if(typeof s=="number"){if(e==="cash")this.stats.cash+=s;else if(e==="income")this.stats.income+=s;else if(e==="insight")this.stats.insight=Math.min(100,Math.max(0,this.stats.insight+s));else if(e==="monthlyExpense")this.stats.monthlyExpense+=s;else if(e.startsWith("skill_")){const n=e.replace("skill_","");this.study(n,s*20)}}this.recalculateWealth()}}logEvent(t,e){this.lifeLog.push({age:this.age,month:this.month,event:t.title,choice:(e==null?void 0:e.text)||"è‡ªåŠ¨",timestamp:Date.now()})}calculateLifeScore(){const{wealth:t,income:e,insight:s}=this.stats;let n=0;t>=1e8?n+=100:t>=1e7?n+=80:t>=1e6?n+=60:t>=1e5?n+=40:t>=0&&(n+=20),n+=Math.min(30,Math.floor(e/1e5)*3),n+=Math.floor(s/2);const a=this.getTopSkill();return n+=Math.floor(a.level/3),this.life.married&&(n+=5),n+=this.life.children*3,n+=this.life.houses.length*10,n+=this.life.cars.length*2,Math.round(n)}getLifeEvaluation(){const{wealth:t}=this.stats;return t>=1e8?{title:"äº¿ä¸‡å¯Œç¿",description:"ä½ å®ç°äº†è´¢åŠ¡è‡ªç”±ï¼Œæˆä¸ºé¡¶çº§å¯Œè±ªï¼",color:16766720}:t>=1e7?{title:"åƒä¸‡èº«å®¶",description:"ä½ ç§¯ç´¯äº†å¯è§‚çš„è´¢å¯Œï¼Œç”Ÿæ´»æ— å¿§",color:16753920}:t>=1e6?{title:"ç™¾ä¸‡å¯Œç¿",description:"ä½ æœ‰äº†ä¸é”™çš„è´¢åŠ¡åŸºç¡€",color:10025880}:t>=1e5?{title:"å°æœ‰ç§¯è“„",description:"ä½ å­˜ä¸‹äº†ä¸€äº›é’±ï¼Œç»§ç»­åŠªåŠ›",color:8900331}:t>=0?{title:"æ”¶æ”¯å¹³è¡¡",description:"æ²¡æœ‰è´Ÿå€ºï¼Œä½†ä¹Ÿæ²¡æœ‰ç§¯è“„",color:12632256}:{title:"è´Ÿå€ºç´¯ç´¯",description:"æŠ•èµ„å¤±è´¥ï¼Œæ¬ ä¸‹å€ºåŠ¡",color:16739179}}save(){const t={name:this.name,age:this.age,month:this.month,startingAge:this.startingAge,startingWealth:this.startingWealth,stats:this.stats,skills:this.skills,life:this.life,loans:this.loans,holdings:this.holdings,holdingIdCounter:this.holdingIdCounter,passiveIncome:this.passiveIncome,lifeLog:this.lifeLog,isAlive:this.isAlive,job:this.job};localStorage.setItem("richgame_save",JSON.stringify(t))}load(){const t=localStorage.getItem("richgame_save");if(!t)return!1;try{const e=JSON.parse(t);return Object.assign(this,e),!0}catch{return!1}}static clearSave(){localStorage.removeItem("richgame_save")}static hasSave(){return!!localStorage.getItem("richgame_save")}}const C={INVEST:{id:"invest",name:"ğŸ’° æŠ•èµ„ç†è´¢",color:"#f0b429"},STUDY:{id:"study",name:"ğŸ“š å­¦ä¹ æå‡",color:"#3b82f6"},CAREER:{id:"career",name:"ğŸ’¼ èŒä¸šå‘å±•",color:"#8b5cf6"},LIFE:{id:"life",name:"ğŸ  ç”Ÿæ´»å†³ç­–",color:"#ec4899"},REST:{id:"rest",name:"ğŸ® ä¼‘æ¯å¨±ä¹",color:"#10b981"}},_={buy_stock:{id:"buy_stock",category:"invest",name:"ä¹°è‚¡ç¥¨",description:"ç ”ç©¶å¹¶ä¹°å…¥è‚¡ç¥¨",timeMonths:1,minCash:1e4,execute:(i,t)=>{const e=t.amount||Math.min(5e4,i.stats.cash*.2);return i.buyInvestment("stock",t.name||"è‚¡ç¥¨æŠ•èµ„",e)}},buy_fund:{id:"buy_fund",category:"invest",name:"ä¹°åŸºé‡‘",description:"è´­ä¹°åŸºé‡‘å®šæŠ•",timeMonths:1,minCash:5e3,execute:(i,t)=>{const e=t.amount||Math.min(3e4,i.stats.cash*.15);return i.buyInvestment("fund",t.name||"æŒ‡æ•°åŸºé‡‘",e)}},buy_crypto:{id:"buy_crypto",category:"invest",name:"ä¹°åŠ å¯†è´§å¸",description:"æŠ•èµ„æ¯”ç‰¹å¸ç­‰åŠ å¯†è´§å¸",timeMonths:1,minCash:5e3,execute:(i,t)=>{const e=t.amount||Math.min(3e4,i.stats.cash*.1);return i.buyInvestment("crypto",t.name||"åŠ å¯†è´§å¸",e)}},manage_holdings:{id:"manage_holdings",category:"invest",name:"ç®¡ç†æŒä»“",description:"æŸ¥çœ‹å’Œè°ƒæ•´æŠ•èµ„ç»„åˆ",timeMonths:0,minCash:0,isPanel:!0},study_stock:{id:"study_stock",category:"study",name:"å­¦ä¹ è‚¡ç¥¨",description:"å­¦ä¹ è‚¡ç¥¨åˆ†ææŠ€æœ¯",timeMonths:2,cost:5e3,execute:i=>(i.stats.cash-=5e3,{skill:"stock",gain:i.study("stock",100)})},study_fund:{id:"study_fund",category:"study",name:"å­¦ä¹ åŸºé‡‘",description:"å­¦ä¹ åŸºé‡‘æŠ•èµ„ç­–ç•¥",timeMonths:2,cost:3e3,execute:i=>(i.stats.cash-=3e3,{skill:"fund",gain:i.study("fund",100)})},study_crypto:{id:"study_crypto",category:"study",name:"å­¦ä¹ åŠ å¯†è´§å¸",description:"ç ”ç©¶åŒºå—é“¾å’ŒåŠ å¯†è´§å¸",timeMonths:2,cost:3e3,execute:i=>(i.stats.cash-=3e3,{skill:"crypto",gain:i.study("crypto",100)})},study_real_estate:{id:"study_real_estate",category:"study",name:"å­¦ä¹ æˆ¿äº§æŠ•èµ„",description:"ç ”ç©¶æˆ¿åœ°äº§å¸‚åœº",timeMonths:2,cost:5e3,execute:i=>(i.stats.cash-=5e3,{skill:"real_estate",gain:i.study("real_estate",100)})},study_business:{id:"study_business",category:"study",name:"å­¦ä¹ åˆ›ä¸šç®¡ç†",description:"å­¦ä¹ å•†ä¸šè¿è¥çŸ¥è¯†",timeMonths:3,cost:8e3,execute:i=>(i.stats.cash-=8e3,{skill:"business",gain:i.study("business",150)})},study_career:{id:"study_career",category:"study",name:"è€ƒèŒä¸šè¯ä¹¦",description:"è€ƒå–ä¸“ä¸šèµ„æ ¼è¯ä¹¦",timeMonths:3,cost:1e4,execute:i=>{i.stats.cash-=1e4;const t=i.study("career",150);return Math.random()<.6?(i.stats.income+=12e3,{skill:"career",gain:t,incomeBonus:12e3}):{skill:"career",gain:t}}},work_hard:{id:"work_hard",category:"career",name:"åŠªåŠ›å·¥ä½œ",description:"åŠ ç­äº‰å–å‡èŒåŠ è–ª",timeMonths:2,execute:i=>{const e=.3+(i.skills.career||0)*.005;if(Math.random()<e){const s=Math.floor(i.stats.income*.1);return i.stats.income+=s,{success:!0,raise:s}}return{success:!1}}},find_job:{id:"find_job",category:"career",name:"æ‰¾æ–°å·¥ä½œ",description:"æŠ•ç®€å†é¢è¯•è·³æ§½",timeMonths:2,execute:i=>{const e=.4+(i.skills.career||0)*.006;if(Math.random()<e){const s=Math.floor(i.stats.income*(1.2+Math.random()*.3)),n=s-i.stats.income;return i.stats.income=s,{success:!0,increase:n}}return{success:!1}}},side_business:{id:"side_business",category:"career",name:"æå‰¯ä¸š",description:"åˆ©ç”¨ä¸šä½™æ—¶é—´èµšå¤–å¿«",timeMonths:1,execute:i=>{const t=i.skills.business||0,e=2e3+Math.random()*8e3,s=Math.floor(e*(1+t*.02));return i.stats.cash+=s,Math.random()<.3&&i.study("business",30),{earn:s}}},start_business:{id:"start_business",category:"career",name:"åˆ›ä¸š",description:"è¾èŒåˆ›ä¸šï¼ˆé«˜é£é™©é«˜å›æŠ¥ï¼‰",timeMonths:6,minCash:1e5,execute:(i,t)=>{const e=t.amount||1e5;if(i.stats.cash<e)return{success:!1,reason:"èµ„é‡‘ä¸è¶³"};i.stats.cash-=e;const n=.2+(i.skills.business||0)*.008;return Math.random()<n?(i.buyInvestment("business",t.name||"åˆ›ä¸šé¡¹ç›®",e*2),i.stats.income=0,{success:!0,investment:e}):(i.study("business",50),{success:!1,lost:e})}},dating:{id:"dating",category:"life",name:"ç›¸äº²çº¦ä¼š",description:"å¯»æ‰¾äººç”Ÿä¼´ä¾£",timeMonths:1,cost:3e3,condition:i=>!i.life.married,execute:i=>{i.stats.cash-=3e3;const t=.3+i.stats.insight*.003;return Math.random()<t?{success:!0,message:"é‡åˆ°äº†å¿ƒä»ªçš„å¯¹è±¡"}:{success:!1}}},marry:{id:"marry",category:"life",name:"ç»“å©š",description:"ä¸¾åŠå©šç¤¼ï¼Œå¼€å§‹æ–°ç”Ÿæ´»",timeMonths:3,cost:2e5,minCash:15e4,condition:i=>!i.life.married,execute:(i,t)=>{const e=t.cost||2e5;return i.stats.cash-=e,i.marry({income:t.spouseIncome||6e4}),{success:!0,cost:e}}},have_baby:{id:"have_baby",category:"life",name:"ç”Ÿå­©å­",description:"è¿æ¥æ–°ç”Ÿå‘½",timeMonths:6,cost:5e4,condition:i=>i.life.married&&i.life.children<3,execute:i=>(i.stats.cash-=5e4,i.haveBaby(),{success:!0})},buy_car:{id:"buy_car",category:"life",name:"ä¹°è½¦",description:"è´­ä¹°ä»£æ­¥å·¥å…·",timeMonths:1,minCash:1e5,execute:(i,t)=>{const e=t.price||15e4;return i.stats.cash-=e,i.buyCar({name:t.name||"æ±½è½¦",price:e}),{success:!0,price:e}}},buy_house:{id:"buy_house",category:"life",name:"ä¹°æˆ¿",description:"è´­ä¹°æˆ¿äº§ï¼ˆå¯è´·æ¬¾ï¼‰",timeMonths:2,minCash:3e5,execute:(i,t)=>{const e=t.price||2e6,s=t.downPayment||e*.3;i.stats.cash-=s,i.buyHouse({name:t.name||"ä½å®…",price:e});const n=e-s;return n>0&&i.takeLoan("MORTGAGE",n,t.years||30),{success:!0,price:e,downPayment:s,loan:n}}},rest:{id:"rest",category:"rest",name:"ä¼‘æ¯æ”¾æ¾",description:"ç»™è‡ªå·±æ”¾ä¸ªå‡",timeMonths:1,cost:2e3,execute:i=>(i.stats.cash-=2e3,i.stats.insight=Math.min(100,i.stats.insight+2),{insight:2})},travel:{id:"travel",category:"rest",name:"æ—…æ¸¸åº¦å‡",description:"å‡ºå»èµ°èµ°çœ‹çœ‹ä¸–ç•Œ",timeMonths:1,cost:1e4,execute:i=>(i.stats.cash-=1e4,i.stats.insight=Math.min(100,i.stats.insight+5),{insight:5})},skip_month:{id:"skip_month",category:"rest",name:"å¹³æ·¡åº¦è¿‡",description:"è¿™ä¸ªæœˆæ²¡ä»€ä¹ˆç‰¹åˆ«çš„",timeMonths:1,execute:()=>({})}},w=.35,T="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",S=`ä½ æ˜¯å¯Œç¿æ¨¡æ‹Ÿå™¨çš„äº‹ä»¶ç”Ÿæˆå™¨ã€‚æ ¹æ®ç©å®¶çŠ¶æ€ç”ŸæˆæŠ•èµ„ç†è´¢æˆ–ç”Ÿæ´»å¤§äº‹äº‹ä»¶ã€‚

## äº‹ä»¶ç±»å‹å’Œæ—¶é—´æ¶ˆè€—
æ¯ä¸ªäº‹ä»¶æ¶ˆè€—ä¸åŒæœˆæ•°ï¼Œç©å®¶æ¯å¹´æœ‰12ä¸ªæœˆå¯ç”¨ï¼š
- æŠ•èµ„ç†è´¢ï¼ˆ1-2æœˆï¼‰ï¼šè‚¡ç¥¨ã€åŸºé‡‘ã€åŠ å¯†è´§å¸ã€ç†è´¢äº§å“
- å­¦ä¹ æå‡ï¼ˆ2-3æœˆï¼‰ï¼šè¯¾ç¨‹å­¦ä¹ ã€è€ƒè¯ã€ç ”ç©¶æŸé¢†åŸŸ
- èŒä¸šå‘å±•ï¼ˆ1-2æœˆï¼‰ï¼šè·³æ§½ã€å‡èŒã€å‰¯ä¸šã€åˆ›ä¸š
- ç”Ÿæ´»å¤§äº‹ï¼ˆ2-6æœˆï¼‰ï¼šç»“å©šã€ç”Ÿå­©å­ã€ä¹°æˆ¿ã€ä¹°è½¦
- æ—¥å¸¸å†³ç­–ï¼ˆ1æœˆï¼‰ï¼šå°é¢æ¶ˆè´¹ã€æ—¥å¸¸æŠ•èµ„è°ƒæ•´

## å¿…é¡»åŒ…å«çš„å†…å®¹ç±»å‹ï¼ˆè½®æµç”Ÿæˆï¼Œä¿æŒå¤šæ ·æ€§ï¼‰
1. æŠ•èµ„æœºä¼šï¼šè‚¡ç¥¨ã€åŸºé‡‘ã€æˆ¿äº§ã€åŠ å¯†è´§å¸ã€åˆ›ä¸šæŠ•èµ„
2. å­¦ä¹ æœºä¼šï¼šä¸“ä¸šæŠ€èƒ½å­¦ä¹ ï¼ˆè‚¡ç¥¨åˆ†æã€æˆ¿äº§æŠ•èµ„ã€åˆ›ä¸šç®¡ç†ç­‰ï¼‰
3. èŒä¸šäº‹ä»¶ï¼šæ¶¨è–ªã€è·³æ§½ã€è¢«è£ã€å‡èŒã€å‰¯ä¸š
4. ç”Ÿæ´»å¤§äº‹ï¼šç›¸äº²/ç»“å©šï¼ˆæœªå©šæ—¶ï¼‰ã€ç”Ÿå­©å­ï¼ˆå·²å©šæ—¶ï¼‰ã€ä¹°æˆ¿ã€ä¹°è½¦
5. è´·æ¬¾ç›¸å…³ï¼šæˆ¿è´·ã€è½¦è´·ã€æ¶ˆè´¹è´·
6. æ„å¤–äº‹ä»¶ï¼šå¸‚åœºæ³¢åŠ¨ã€æ”¿ç­–å˜åŒ–ã€ç»æµå‘¨æœŸ

## æ ¹æ®ç©å®¶çŠ¶æ€è°ƒæ•´
- æœªå©šä¸”>25å²ï¼šå¢åŠ ç›¸äº²/ç»“å©šäº‹ä»¶æ¦‚ç‡
- å·²å©šæ— å­å¥³ï¼šå¢åŠ ç”Ÿå­©å­äº‹ä»¶
- æ— æˆ¿ä¸”ç°é‡‘>50ä¸‡ï¼šå¢åŠ ä¹°æˆ¿æœºä¼š
- æ— è½¦ä¸”ç°é‡‘>15ä¸‡ï¼šå¢åŠ ä¹°è½¦æœºä¼š
- æŸæŠ€èƒ½ç­‰çº§é«˜ï¼šè¯¥é¢†åŸŸæ›´å¥½çš„æœºä¼š
- è´Ÿå€ºé«˜ï¼šå¢åŠ è¿˜è´·å‹åŠ›äº‹ä»¶

## é‡‘é¢è§„åˆ™
- å°é¢æŠ•èµ„ï¼š1-10ä¸‡
- ä¸­é¢æŠ•èµ„ï¼š10-100ä¸‡
- å¤§é¢æŠ•èµ„ï¼š100ä¸‡+
- ç»“å©šè´¹ç”¨ï¼š15-50ä¸‡
- ç”Ÿå­©å­ï¼š3-10ä¸‡ï¼ˆä¸€æ¬¡æ€§ï¼‰+ æ¯æœˆ3000å…»è‚²è´¹
- ä¹°è½¦ï¼š10-50ä¸‡
- ä¹°æˆ¿é¦–ä»˜ï¼š50-200ä¸‡
- å­¦ä¹ è´¹ç”¨ï¼š0.5-5ä¸‡

## effectå­—æ®µè¯´æ˜
- cash: ç°é‡‘å˜åŒ–ï¼ˆæ­£=æ”¶å…¥ï¼Œè´Ÿ=æ”¯å‡ºï¼‰
- income: å¹´æ”¶å…¥å˜åŒ–
- monthlyExpense: æœˆå›ºå®šæ”¯å‡ºå˜åŒ–
- insight: æŠ•èµ„çœ¼å…‰å˜åŒ–
- skill_stock/skill_fund/skill_real_estate/skill_crypto/skill_business/skill_career: æŠ€èƒ½ç­‰çº§å˜åŒ–

## ç‰¹æ®ŠåŠ¨ä½œï¼ˆé€šè¿‡actionå­—æ®µè§¦å‘ï¼‰
- action: "marry" - ç»“å©š
- action: "baby" - ç”Ÿå­©å­
- action: "buy_house" - ä¹°æˆ¿ï¼ˆéœ€é…åˆloanå­—æ®µï¼‰
- action: "buy_car" - ä¹°è½¦
- action: "loan" - è´·æ¬¾ï¼Œéœ€è¦loan: { type: "mortgage/car_loan/consumer", amount: æ•°å­—, years: å¹´æ•° }
- action: "buy_investment" - ä¹°å…¥æŠ•èµ„å“ï¼Œéœ€è¦investment: { type: "stock/fund/crypto/business", name: "æŠ•èµ„å“åç§°", amount: æŠ•èµ„é‡‘é¢ }

## æŠ•èµ„äº‹ä»¶é‡è¦è¯´æ˜
å½“ç”ŸæˆæŠ•èµ„ç†è´¢ç±»äº‹ä»¶æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ buy_investment åŠ¨ä½œè®©ç©å®¶å»ºç«‹æŒä»“ï¼š
- stock: è‚¡ç¥¨æŠ•èµ„ï¼Œå¦‚"ç§‘æŠ€é¾™å¤´è‚¡"ã€"æ–°èƒ½æºæ¦‚å¿µè‚¡"ã€"æ¶ˆè´¹ç™½é©¬è‚¡"
- fund: åŸºé‡‘æŠ•èµ„ï¼Œå¦‚"æ²ªæ·±300æŒ‡æ•°åŸºé‡‘"ã€"ç§‘æŠ€ä¸»é¢˜åŸºé‡‘"ã€"å€ºåˆ¸åŸºé‡‘"
- crypto: åŠ å¯†è´§å¸ï¼Œå¦‚"æ¯”ç‰¹å¸"ã€"ä»¥å¤ªåŠ"
- business: åˆ›ä¸šæŠ•èµ„ï¼Œå¦‚"æœ‹å‹çš„å¥¶èŒ¶åº—"ã€"å°å‹ç”µå•†é¡¹ç›®"

æŠ•èµ„é‡‘é¢åº”æ ¹æ®ç©å®¶ç°é‡‘åˆç†è®¾ç½®ï¼Œé€šå¸¸å»ºè®®æŠ•å…¥ç°é‡‘çš„10%-30%ã€‚

è¿”å›JSONæ ¼å¼ï¼š
{
  "category": "æŠ•èµ„ç†è´¢/å­¦ä¹ æå‡/èŒä¸šå‘å±•/ç”Ÿæ´»å¤§äº‹/æ—¥å¸¸å†³ç­–",
  "timeMonths": 1-6,
  "title": "æ ‡é¢˜4-8å­—",
  "description": "æè¿°40-100å­—ï¼ŒåŒ…å«å…·ä½“é‡‘é¢å’ŒèƒŒæ™¯",
  "choices": [
    {
      "text": "é€‰é¡¹æè¿°",
      "resultText": "é€‰æ‹©åçš„ç»“æœæè¿°ï¼ˆ30-80å­—ï¼Œæè¿°è¿™ä¸ªé€‰æ‹©å¸¦æ¥çš„å…·ä½“åæœï¼Œè¦ç”ŸåŠ¨çœŸå®ï¼‰",
      "effect": { "cash": 0, "income": 0, "insight": 0, ... },
      "action": "å¯é€‰çš„ç‰¹æ®ŠåŠ¨ä½œ",
      "investment": { "type": "stock", "name": "ç§‘æŠ€é¾™å¤´è‚¡", "amount": 50000 },
      "loan": { "type": "mortgage", "amount": 1000000, "years": 30 }
    }
  ]
}

## é‡è¦ï¼šé€‰é¡¹æ•°é‡è¦æ±‚
æ¯ä¸ªäº‹ä»¶å¿…é¡»æœ‰ 2-3 ä¸ªé€‰é¡¹ï¼Œè®©ç©å®¶æœ‰é€‰æ‹©çš„ä½™åœ°ï¼š
- ç§¯æé€‰é¡¹ï¼šæŠ•å…¥èµ„æºï¼ˆé‡‘é’±/æ—¶é—´ï¼‰è·å¾—æ½œåœ¨æ”¶ç›Š
- ä¿å®ˆé€‰é¡¹ï¼šä¸æŠ•å…¥æˆ–å°‘æŠ•å…¥ï¼Œé£é™©å°ä½†æ”¶ç›Šä¹Ÿå°
- å¯é€‰çš„ä¸­é—´é€‰é¡¹ï¼šæŠ˜ä¸­æ–¹æ¡ˆ
ç»å¯¹ä¸è¦åªç»™1ä¸ªé€‰é¡¹ï¼

## resultText ç¤ºä¾‹
- æŠ•èµ„æˆåŠŸï¼š"ä½ ä¹°å…¥çš„è‚¡ç¥¨åœ¨ä¸‰ä¸ªæœˆå†…æ¶¨äº†30%ï¼ŒæˆåŠŸè·åˆ©å‡ºåœºã€‚è¿™æ¬¡ç»éªŒè®©ä½ å¯¹æŠ€æœ¯åˆ†ææ›´æœ‰ä¿¡å¿ƒã€‚"
- æŠ•èµ„å¤±è´¥ï¼š"å¸‚åœºçªç„¶æš´è·Œï¼Œä½ çš„æœ¬é‡‘äºæŸäº†40%ã€‚è™½ç„¶ç—›è‹¦ï¼Œä½†è¿™è®©ä½ å­¦ä¼šäº†æ­¢æŸçš„é‡è¦æ€§ã€‚"
- å­¦ä¹ ï¼š"ç»è¿‡ä¸¤ä¸ªæœˆçš„ç³»ç»Ÿå­¦ä¹ ï¼Œä½ æŒæ¡äº†åŸºé‡‘å®šæŠ•çš„æ ¸å¿ƒç­–ç•¥ï¼Œå¯¹å¸‚åœºå‘¨æœŸæœ‰äº†æ›´æ·±çš„ç†è§£ã€‚"
- ç»“å©šï¼š"ä½ ä»¬ä¸¾åŠäº†æ¸©é¦¨çš„å©šç¤¼ï¼Œè™½ç„¶èŠ±è´¹ä¸å°‘ï¼Œä½†æ”¶è·äº†æ»¡æ»¡çš„ç¥ç¦ã€‚ä»æ­¤æœ‰äººä¸ä½ å…±æ‹…é£é›¨ã€‚"
- ä¹°æˆ¿ï¼š"ç­¾å®ŒåˆåŒçš„é‚£ä¸€åˆ»ï¼Œä½ ç»ˆäºæœ‰äº†å±äºè‡ªå·±çš„å®¶ã€‚è™½ç„¶èƒŒä¸Šäº†æˆ¿è´·ï¼Œä½†å¿ƒé‡Œè¸å®äº†ã€‚"

åªè¿”å›JSONï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚`,B=[{type:"æŠ•èµ„ç†è´¢",weight:30},{type:"å­¦ä¹ æå‡",weight:15},{type:"èŒä¸šå‘å±•",weight:20},{type:"ç”Ÿæ´»å¤§äº‹",weight:25},{type:"æ—¥å¸¸å†³ç­–",weight:10}];async function L(i,t){var o,c,l;const e=P(i),s=A(e),n=R(i),a=`ç©å®¶çŠ¶æ€ï¼š
- å¹´é¾„ï¼š${i.age}å²
- å½“å‰æœˆä»½ï¼š${i.month}æœˆï¼ˆä»Šå¹´å‰©ä½™${i.getRemainingMonths()}ä¸ªæœˆï¼‰
- äººç”Ÿé˜¶æ®µï¼š${i.getCurrentStage().name}
- æ€»èµ„äº§ï¼šÂ¥${i.stats.wealth.toLocaleString()}
- å¯ç”¨ç°é‡‘ï¼šÂ¥${i.stats.cash.toLocaleString()}
- å¹´æ”¶å…¥ï¼šÂ¥${i.stats.income.toLocaleString()}
- æœˆæ”¯å‡ºï¼šÂ¥${i.getMonthlyExpense().toLocaleString()}
- æŠ•èµ„çœ¼å…‰ï¼š${i.stats.insight}/100
- å©šå§»çŠ¶æ€ï¼š${i.life.married?"å·²å©š":"æœªå©š"}
- å­å¥³æ•°é‡ï¼š${i.life.children}
- æˆ¿äº§æ•°é‡ï¼š${i.life.houses.length}
- è½¦è¾†æ•°é‡ï¼š${i.life.cars.length}
- æ€»è´Ÿå€ºï¼šÂ¥${i.getTotalDebt().toLocaleString()}
- æŠ€èƒ½ç­‰çº§ï¼šè‚¡ç¥¨${i.skills.stock} åŸºé‡‘${i.skills.fund} æˆ¿äº§${i.skills.real_estate} åŠ å¯†${i.skills.crypto} åˆ›ä¸š${i.skills.business} èŒåœº${i.skills.career}

è¯·ç”Ÿæˆä¸€ä¸ªã€${s}ã€‘ç±»å‹çš„äº‹ä»¶ã€‚${n}

æ³¨æ„ï¼šäº‹ä»¶æ¶ˆè€—çš„æ—¶é—´ä¸èƒ½è¶…è¿‡å‰©ä½™æœˆä»½(${i.getRemainingMonths()}ä¸ªæœˆ)ã€‚`;try{const r=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${T}`},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:S},{role:"user",content:a}],temperature:.9,max_tokens:800,stream:!0})});if(!r.ok)throw new Error(`API error: ${r.status}`);const d=r.body.getReader(),m=new TextDecoder;let h="";for(;;){const{done:u,value:f}=await d.read();if(u)break;const v=m.decode(f).split(`
`).filter(y=>y.trim()!=="");for(const y of v)if(y!=="data: [DONE]"&&y.startsWith("data: "))try{const p=(l=(c=(o=JSON.parse(y.slice(6)).choices)==null?void 0:o[0])==null?void 0:c.delta)==null?void 0:l.content;p&&(h+=p)}catch{}}return N(h,i)}catch(r){return console.error("AI generation error:",r),E(i)}}function P(i){const t=B.map(s=>({...s}));if(!i.life.married&&i.age>25){const s=t.find(n=>n.type==="ç”Ÿæ´»å¤§äº‹");s&&(s.weight+=15)}if(i.life.married&&i.life.children===0&&i.age<40){const s=t.find(n=>n.type==="ç”Ÿæ´»å¤§äº‹");s&&(s.weight+=10)}if(i.life.houses.length===0&&i.stats.cash>5e5){const s=t.find(n=>n.type==="ç”Ÿæ´»å¤§äº‹");s&&(s.weight+=10)}if(i.getTopSkill().level>30){const s=t.find(n=>n.type==="æŠ•èµ„ç†è´¢");s&&(s.weight+=10)}return t}function R(i){const t=[];!i.life.married&&i.age>26&&t.push("ç©å®¶å•èº«è¾ƒä¹…ï¼Œå¯è€ƒè™‘ç›¸äº²/æ‹çˆ±äº‹ä»¶"),i.life.married&&i.life.children===0&&i.age>28&&t.push("ç©å®¶å·²å©šä½†æ— å­å¥³ï¼Œå¯è€ƒè™‘ç”Ÿè‚²ç›¸å…³äº‹ä»¶"),i.life.houses.length===0&&i.stats.cash>3e5&&t.push("ç©å®¶æœ‰ç§¯è“„ä½†æ— æˆ¿ï¼Œå¯è€ƒè™‘ä¹°æˆ¿äº‹ä»¶"),i.life.cars.length===0&&i.stats.cash>15e4&&t.push("ç©å®¶æ— è½¦ï¼Œå¯è€ƒè™‘ä¹°è½¦äº‹ä»¶"),i.getTotalDebt()>i.stats.income*2&&t.push("ç©å®¶è´Ÿå€ºè¾ƒé«˜ï¼Œå¢åŠ è¿˜è´·å‹åŠ›");const e=i.getTopSkill();if(e.level>40){const s={stock:"è‚¡ç¥¨",fund:"åŸºé‡‘",real_estate:"æˆ¿äº§",crypto:"åŠ å¯†è´§å¸",business:"åˆ›ä¸š",career:"èŒåœº"};t.push(`ç©å®¶${s[e.field]}æŠ€èƒ½è¾ƒé«˜(${e.level})ï¼Œå¯æä¾›è¯¥é¢†åŸŸæ›´å¥½æœºä¼š`)}return t.length>0?`

ç‰¹åˆ«æç¤ºï¼š`+t.join("ï¼›"):""}function A(i){const t=i.reduce((s,n)=>s+n.weight,0);let e=Math.random()*t;for(const s of i)if(e-=s.weight,e<=0)return s.type;return i[0].type}function N(i,t){let e=i.trim();e.startsWith("```")&&(e=e.replace(/```json?\n?/g,"").replace(/```/g,""));try{const s=JSON.parse(e);if(!s.title||!s.choices)throw new Error("Invalid format");return s.timeMonths=Math.min(s.timeMonths||1,t.getRemainingMonths()),s.category=s.category||"æ—¥å¸¸å†³ç­–",s.choices=s.choices.map(n=>({text:n.text||"ç»§ç»­",resultText:n.resultText||"",effect:n.effect||{},action:n.action,investment:n.investment,loan:n.loan})),s}catch(s){return console.error("JSON parse error:",s),E(t)}}function E(i){const t=i.getRemainingMonths();return t<=1?{category:"æ—¥å¸¸å†³ç­–",timeMonths:1,title:"å¹´æœ«æ€»ç»“",description:"ä»Šå¹´å³å°†ç»“æŸï¼Œå›é¡¾ä¸€ä¸‹è¿™ä¸€å¹´çš„æ”¶è·ï¼Œä¸ºæ˜å¹´åšå¥½è§„åˆ’ã€‚",choices:[{text:"æ€»ç»“ç»éªŒï¼Œè¿æ¥æ–°å¹´",resultText:"ä½ é™ä¸‹å¿ƒæ¥å›é¡¾è¿™ä¸€å¹´çš„å¾—å¤±ï¼Œæ€»ç»“äº†æŠ•èµ„ä¸­çš„æ•™è®­å’Œç»éªŒã€‚æ–°çš„ä¸€å¹´ï¼Œä½ å°†æ›´åŠ æˆç†Ÿã€‚",effect:{insight:1}}]}:{category:"å­¦ä¹ æå‡",timeMonths:Math.min(2,t),title:"æŠ•èµ„å­¦ä¹ ",description:"å¸‚åœºä¸Šæœ‰å¾ˆå¤šæŠ•èµ„è¯¾ç¨‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªæ–¹å‘æ·±å…¥å­¦ä¹ ã€‚",choices:[{text:"å­¦ä¹ è‚¡ç¥¨æŠ•èµ„",resultText:"ä½ èŠ±äº†ä¸¤ä¸ªæœˆæ—¶é—´ç³»ç»Ÿå­¦ä¹ è‚¡ç¥¨æŠ•èµ„ï¼Œä»Kçº¿å›¾åˆ°è´¢åŠ¡æŠ¥è¡¨åˆ†æï¼Œæ”¶è·é¢‡ä¸°ã€‚è™½ç„¶èŠ±äº†äº›å­¦è´¹ï¼Œä½†æ„Ÿè§‰è‡ªå·±çš„æŠ•èµ„çœ¼å…‰æ˜æ˜¾æå‡äº†ã€‚",effect:{cash:-5e3,skill_stock:5,insight:2}},{text:"å­¦ä¹ åŸºé‡‘å®šæŠ•",resultText:"é€šè¿‡å­¦ä¹ ï¼Œä½ äº†è§£äº†æŒ‡æ•°åŸºé‡‘ã€å®šæŠ•ç­–ç•¥ç­‰çŸ¥è¯†ã€‚åŸæ¥æŠ•èµ„ä¸ä¸€å®šè¦é¢‘ç¹æ“ä½œï¼Œé•¿æœŸæŒæœ‰ä¼˜è´¨åŸºé‡‘ä¹Ÿæ˜¯ä¸€ç§æ™ºæ…§ã€‚",effect:{cash:-3e3,skill_fund:5,insight:2}},{text:"æš‚æ—¶ä¸å­¦ä¹ ",resultText:"ä½ å†³å®šå…ˆè§‚æœ›ï¼ŒæŠŠæ—¶é—´èŠ±åœ¨å…¶ä»–äº‹æƒ…ä¸Šã€‚",effect:{}}]}}class H{constructor(){this.player=new g,this.currentEvent=null,this.isLoading=!1,this.bindEvents(),this.init()}init(){g.hasSave()&&(document.getElementById("btn-continue").style.display="block")}bindEvents(){document.getElementById("btn-new-game").addEventListener("click",()=>{const t=document.getElementById("input-age"),e=document.getElementById("input-wealth"),s=Math.max(18,Math.min(60,parseInt(t.value)||25)),n=Math.max(0,parseFloat(e.value)||10)*1e4;g.clearSave(),this.player.reset(s,n),this.startGame()}),document.getElementById("btn-continue").addEventListener("click",()=>{this.player.load(),this.startGame(!0)}),document.getElementById("btn-next-year").addEventListener("click",()=>{this.nextYear()}),document.getElementById("btn-restart").addEventListener("click",()=>{g.clearSave(),this.showScene("menu-scene"),document.getElementById("btn-continue").style.display="none"})}showScene(t){document.querySelectorAll(".scene").forEach(e=>e.classList.remove("active")),document.getElementById(t).classList.add("active")}startGame(t=!1){this.showScene("game-scene"),this.updateUI(),t?this.player.getRemainingMonths()>0?this.showActionMenu():document.getElementById("btn-next-year").style.display="block":this.showStartInfo()}showStartInfo(){document.getElementById("event-category").textContent="æŠ•èµ„èµ·ç‚¹",document.getElementById("event-title").textContent="ä½ çš„æŠ•èµ„ä¹‹æ—…å¼€å§‹äº†",document.getElementById("event-desc").textContent=`${this.player.age}å²ï¼Œèµ·å§‹èµ„äº§ ${this.formatMoney(this.player.stats.wealth)}ï¼Œå¹´æ”¶å…¥ ${this.formatMoney(this.player.stats.income)}ã€‚

é€‰æ‹©ä½ æƒ³åšçš„äº‹æƒ…ï¼Œæ¯ä¸ªè¡ŒåŠ¨éƒ½ä¼šæ¶ˆè€—æ—¶é—´ã€‚`,document.getElementById("choices").innerHTML="",document.getElementById("btn-next-year").style.display="block"}updateUI(){document.getElementById("player-age").textContent=`${this.player.age} å²`,document.getElementById("player-stage").textContent=this.player.getCurrentStage().name;const t=this.player.getRemainingMonths(),e=12-t;document.getElementById("time-text").textContent=`${this.player.month}æœˆ / å‰©ä½™${t}ä¸ªæœˆ`,document.getElementById("time-fill").style.width=`${e/12*100}%`,document.getElementById("val-wealth").textContent=this.formatMoney(this.player.stats.wealth),document.getElementById("val-cash").textContent=this.formatMoney(this.player.stats.cash),document.getElementById("val-income").textContent=this.formatMoney(this.player.stats.income)+"/å¹´",document.getElementById("val-expense").textContent=this.formatMoney(this.player.getMonthlyExpense())+"/æœˆ";const s=this.player.getTotalDebt(),n=document.getElementById("debt-item");s>0?(document.getElementById("val-debt").textContent=this.formatMoney(s),n.style.display="flex"):n.style.display="none",this.updateLifeTags(),this.updateSkillsGrid(),this.updateHoldingsPanel(),this.player.stats.wealth<0?document.getElementById("val-wealth").style.color="#f85149":document.getElementById("val-wealth").style.color="#3fb950",this.player.save()}updateLifeTags(){const t=document.getElementById("life-tags");t.innerHTML="";const e=document.createElement("span");if(e.className=`life-tag ${this.player.life.married?"active":""}`,e.textContent=this.player.life.married?"ğŸ’’ å·²å©š":"ğŸ’” æœªå©š",t.appendChild(e),this.player.life.children>0){const s=document.createElement("span");s.className="life-tag active",s.textContent=`ğŸ‘¶ ${this.player.life.children}ä¸ªå­©å­`,t.appendChild(s)}if(this.player.life.houses.length>0){const s=document.createElement("span");s.className="life-tag active",s.textContent=`ğŸ  ${this.player.life.houses.length}å¥—æˆ¿`,t.appendChild(s)}if(this.player.life.cars.length>0){const s=document.createElement("span");s.className="life-tag active",s.textContent=`ğŸš— ${this.player.life.cars.length}è¾†è½¦`,t.appendChild(s)}}updateSkillsGrid(){const t=document.getElementById("skills-grid");t.innerHTML="";const e=document.createElement("div");e.className="skill-item",e.style.background="rgba(240, 136, 62, 0.15)",e.style.color="#f0883e",e.innerHTML=`
      <span class="skill-icon">ğŸ‘ï¸</span>
      <span class="skill-name">çœ¼å…‰</span>
      <span class="skill-level">${this.player.stats.insight}</span>
    `,t.appendChild(e);const s={stock:{name:"è‚¡ç¥¨",icon:"ğŸ“Š"},fund:{name:"åŸºé‡‘",icon:"ğŸ“ˆ"},real_estate:{name:"æˆ¿äº§",icon:"ğŸ "},crypto:{name:"åŠ å¯†",icon:"â‚¿"},business:{name:"åˆ›ä¸š",icon:"ğŸ¢"},career:{name:"èŒåœº",icon:"ğŸ’¼"}};for(const[n,a]of Object.entries(this.player.skills)){const o=s[n];if(!o)continue;const c=document.createElement("div");c.className="skill-item",a>0&&(c.style.background="rgba(88, 166, 255, 0.15)",c.style.color="#58a6ff"),c.innerHTML=`
        <span class="skill-icon">${o.icon}</span>
        <span class="skill-name">${o.name}</span>
        <span class="skill-level">${a}</span>
      `,t.appendChild(c)}}updateHoldingsPanel(){const t=document.getElementById("holdings-panel"),e=document.getElementById("holdings-list"),s=document.getElementById("holdings-summary");if(this.player.holdings.length===0){t.style.display="none";return}t.style.display="block";const n=this.player.getHoldingsValue(),a=this.player.getHoldingsProfit(),o=a>=0?"profit":"loss",c=a>=0?"+":"";s.innerHTML=`å¸‚å€¼ ${this.formatMoney(n)} <span class="${o}">${c}${this.formatMoney(a)}</span>`,e.innerHTML="";const l={stock:"ğŸ“Š",fund:"ğŸ“ˆ",crypto:"â‚¿",business:"ğŸ¢"};this.player.holdings.forEach(r=>{const d=r.shares*r.currentPrice,m=r.profitRate.toFixed(1),h=r.profit>=0?"positive":"negative",u=r.profit>=0?"+":"",f=document.createElement("div");f.className="holding-item",f.innerHTML=`
        <div class="holding-info">
          <div class="holding-name">${l[r.type]||"ğŸ“¦"} ${r.name}</div>
          <div class="holding-detail">æˆæœ¬ ${this.formatMoney(r.amount)} Â· ${r.buyTime.age}å²${r.buyTime.month}æœˆä¹°å…¥</div>
          <div class="holding-actions">
            <button class="holding-btn sell" data-id="${r.id}">å–å‡º</button>
            <button class="holding-btn add" data-id="${r.id}">åŠ ä»“</button>
          </div>
        </div>
        <div class="holding-value">
          <div class="holding-amount">${this.formatMoney(d)}</div>
          <div class="holding-profit ${h}">${u}${m}%</div>
        </div>
      `,e.appendChild(f)}),e.querySelectorAll(".holding-btn.sell").forEach(r=>{r.addEventListener("click",d=>{d.stopPropagation();const m=parseInt(d.target.dataset.id);this.showSellDialog(m)})}),e.querySelectorAll(".holding-btn.add").forEach(r=>{r.addEventListener("click",d=>{d.stopPropagation();const m=parseInt(d.target.dataset.id);this.showAddPositionDialog(m)})})}showSellDialog(t){const e=this.player.holdings.find(o=>o.id===t);if(!e)return;const s=e.shares*e.currentPrice,n=e.profit,a=n>=0?`ç›ˆåˆ© ${this.formatMoney(n)}`:`äºæŸ ${this.formatMoney(Math.abs(n))}`;if(confirm(`ç¡®å®šå–å‡ºã€Œ${e.name}ã€ï¼Ÿ
å½“å‰å¸‚å€¼: ${this.formatMoney(s)}
${a}`)){const o=this.player.sellInvestment(t);if(o){const c=o.profit>=0?`å–å‡ºæˆåŠŸï¼è·å¾— ${this.formatMoney(o.cash)}ï¼Œç›ˆåˆ© ${o.profitRate.toFixed(1)}%`:`å–å‡ºæˆåŠŸï¼è·å¾— ${this.formatMoney(o.cash)}ï¼ŒäºæŸ ${Math.abs(o.profitRate).toFixed(1)}%`;alert(c),this.updateUI()}}}showAddPositionDialog(t){const e=this.player.holdings.find(n=>n.id===t);if(!e)return;const s=prompt(`åŠ ä»“ã€Œ${e.name}ã€
å½“å‰å¯ç”¨ç°é‡‘: ${this.formatMoney(this.player.stats.cash)}
è¯·è¾“å…¥åŠ ä»“é‡‘é¢ï¼ˆä¸‡ï¼‰:`);if(s){const n=parseFloat(s)*1e4;n>0&&n<=this.player.stats.cash?(this.player.addToPosition(t,n),alert(`åŠ ä»“æˆåŠŸï¼å·²æŠ•å…¥ ${this.formatMoney(n)}`),this.updateUI()):alert("é‡‘é¢æ— æ•ˆæˆ–ç°é‡‘ä¸è¶³")}}formatMoney(t){return t>=1e8?`Â¥${(t/1e8).toFixed(2)}äº¿`:t>=1e4?`Â¥${(t/1e4).toFixed(1)}ä¸‡`:t<0?t<=-1e4?`-Â¥${Math.abs(t/1e4).toFixed(1)}ä¸‡`:`-Â¥${Math.abs(t).toLocaleString()}`:`Â¥${t.toLocaleString()}`}showActionMenu(){if(this.player.getRemainingMonths()<=0){this.showYearEnd();return}document.getElementById("btn-next-year").style.display="none",document.getElementById("effects").innerHTML="",document.getElementById("event-category").textContent="é€‰æ‹©è¡ŒåŠ¨",document.getElementById("event-title").textContent="ä½ æƒ³åšä»€ä¹ˆï¼Ÿ",document.getElementById("event-desc").textContent=`å½“å‰${this.player.month}æœˆï¼Œä»Šå¹´è¿˜å‰©${this.player.getRemainingMonths()}ä¸ªæœˆã€‚é€‰æ‹©ä¸€ä¸ªè¡ŒåŠ¨æ¥æ¨è¿›ä½ çš„äººç”Ÿã€‚`,this.renderActionButtons()}renderActionButtons(){const t=document.getElementById("choices");t.innerHTML="";let e=!0;for(const[s,n]of Object.entries(C)){const a=Object.values(_).filter(r=>r.category===s.toLowerCase());if(a.length===0)continue;const o=document.createElement("div");o.className=`action-category ${e?"expanded":""}`;const c=document.createElement("div");c.className="action-category-header",c.innerHTML=`
        <span class="action-category-title" style="color: ${n.color}">${n.name}</span>
        <span class="action-category-arrow">â–¼</span>
      `,c.addEventListener("click",()=>{o.classList.toggle("expanded")}),o.appendChild(c);const l=document.createElement("div");l.className="actions-grid",a.forEach(r=>{const d=this.isActionAvailable(r),m=document.createElement("button");m.className=`action-btn ${d?"":"disabled"}`;const h=r.timeMonths>0?`${r.timeMonths}æœˆ`:"å³æ—¶";let u="";r.cost?u=this.formatMoney(r.cost):r.minCash&&(u=`éœ€${this.formatMoney(r.minCash)}+`),m.innerHTML=`
          <div class="action-name">${r.name}</div>
          <div class="action-meta">
            <span class="action-time">${h}</span>
            ${u?`<span class="action-cost">${u}</span>`:""}
          </div>
        `,d?m.addEventListener("click",f=>{f.stopPropagation(),this.executeAction(r)}):m.title=this.getUnavailableReason(r),l.appendChild(m)}),o.appendChild(l),t.appendChild(o),e=!1}}isActionAvailable(t){const e=this.player.getRemainingMonths();return!(t.timeMonths>e||t.condition&&!t.condition(this.player)||t.minCash&&this.player.stats.cash<t.minCash||t.cost&&this.player.stats.cash<t.cost)}getUnavailableReason(t){const e=this.player.getRemainingMonths();return t.timeMonths>e?`æ—¶é—´ä¸è¶³ï¼ˆéœ€è¦${t.timeMonths}ä¸ªæœˆï¼‰`:t.condition&&!t.condition(this.player)?"æ¡ä»¶ä¸æ»¡è¶³":t.minCash&&this.player.stats.cash<t.minCash?`ç°é‡‘ä¸è¶³ï¼ˆéœ€è¦${this.formatMoney(t.minCash)}ï¼‰`:t.cost&&this.player.stats.cash<t.cost?`ç°é‡‘ä¸è¶³ï¼ˆéœ€è¦${this.formatMoney(t.cost)}ï¼‰`:"æ— æ³•æ‰§è¡Œ"}async executeAction(t){if(t.isPanel){t.id==="manage_holdings"&&this.showHoldingsManagement();return}if((t.id==="buy_stock"||t.id==="buy_fund"||t.id==="buy_crypto")&&!await this.showInvestDialog(t)||t.id==="buy_car"&&!await this.showBuyCarDialog()||t.id==="buy_house"&&!await this.showBuyHouseDialog()||t.id==="marry"&&!await this.showMarryDialog()||t.id==="start_business"&&!await this.showStartBusinessDialog())return;t.timeMonths>0&&this.player.spendTime(t.timeMonths);let e={};t.execute&&!t.isPanel&&(e=t.execute(this.player,this.actionParams||{})),this.actionParams=null,this.showActionResult(t,e),this.updateUI(),Math.random()<w&&t.timeMonths>0?setTimeout(()=>{this.triggerRandomEvent()},1500):setTimeout(()=>{this.showActionMenu()},1500)}showActionResult(t,e){document.getElementById("choices").innerHTML="",document.getElementById("event-category").textContent="è¡ŒåŠ¨ç»“æœ",document.getElementById("event-title").textContent=t.name;let s="";const n=document.getElementById("effects");switch(n.innerHTML="",t.id){case"buy_stock":case"buy_fund":case"buy_crypto":s=`ä½ æŠ•å…¥äº†èµ„é‡‘è¿›è¡Œ${t.name}ï¼Œå»ºä»“å®Œæˆã€‚æ¥ä¸‹æ¥å°±çœ‹å¸‚åœºè¡¨ç°äº†ã€‚`;break;case"study_stock":case"study_fund":case"study_crypto":case"study_real_estate":case"study_business":case"study_career":s=`ç»è¿‡${t.timeMonths}ä¸ªæœˆçš„å­¦ä¹ ï¼Œä½ çš„${t.name.replace("å­¦ä¹ ","")}æŠ€èƒ½æå‡äº†${e.gain||0}ç‚¹ã€‚`,e.incomeBonus&&(s+=`
è€ƒè¯æˆåŠŸï¼å¹´æ”¶å…¥å¢åŠ  ${this.formatMoney(e.incomeBonus)}ï¼`,this.addEffectItem(n,"å¹´æ”¶å…¥",`+${this.formatMoney(e.incomeBonus)}`,!0)),this.addEffectItem(n,"æŠ€èƒ½",`+${e.gain||0}`,!0);break;case"work_hard":e.success?(s=`ä½ çš„åŠªåŠ›å¾—åˆ°äº†è®¤å¯ï¼ŒæˆåŠŸè·å¾—åŠ è–ª ${this.formatMoney(e.raise)}/å¹´ï¼`,this.addEffectItem(n,"å¹´æ”¶å…¥",`+${this.formatMoney(e.raise)}`,!0)):s="è™½ç„¶ä½ å¾ˆåŠªåŠ›ï¼Œä½†è¿™æ¬¡æ²¡æœ‰è·å¾—åŠ è–ªæœºä¼šã€‚ç»§ç»­åŠ æ²¹ï¼";break;case"find_job":e.success?(s=`é¢è¯•æˆåŠŸï¼ä½ è·³æ§½åˆ°äº†æ–°å…¬å¸ï¼Œå¹´æ”¶å…¥å¢åŠ  ${this.formatMoney(e.increase)}ï¼`,this.addEffectItem(n,"å¹´æ”¶å…¥",`+${this.formatMoney(e.increase)}`,!0)):s="è¿™æ¬¡æ±‚èŒä¸å¤ªé¡ºåˆ©ï¼Œæ²¡æœ‰æ‰¾åˆ°æ»¡æ„çš„offerã€‚ä¸‹æ¬¡å†è¯•è¯•ã€‚";break;case"side_business":s=`è¿™ä¸ªæœˆçš„å‰¯ä¸šæ”¶å…¥ ${this.formatMoney(e.earn)}ï¼Œä¸é”™çš„é¢å¤–æ”¶å…¥ï¼`,this.addEffectItem(n,"ç°é‡‘",`+${this.formatMoney(e.earn)}`,!0);break;case"start_business":e.success?(s="åˆ›ä¸šæˆåŠŸï¼ä½ çš„é¡¹ç›®å¼€å§‹ç›ˆåˆ©ï¼Œä»·å€¼ç¿»å€ï¼ä¸è¿‡ä½ å·²ç»è¾èŒï¼Œæ²¡æœ‰å·¥èµ„æ”¶å…¥äº†ã€‚",this.addEffectItem(n,"åˆ›ä¸š","æˆåŠŸ",!0)):(s=`åˆ›ä¸šå¤±è´¥ï¼ŒæŸå¤±äº† ${this.formatMoney(e.lost)}ã€‚ä½†è¿™æ¬¡ç»å†è®©ä½ å­¦åˆ°äº†å¾ˆå¤šã€‚`,this.addEffectItem(n,"ç°é‡‘",`-${this.formatMoney(e.lost)}`,!1));break;case"dating":e.success?s=e.message+"ï¼Œç»§ç»­å‘å±•çœ‹çœ‹ï¼":s="è¿™æ¬¡æ²¡æœ‰é‡åˆ°åˆé€‚çš„äººï¼Œç¼˜åˆ†è¿˜æ²¡åˆ°ã€‚";break;case"marry":s="æ­å–œä½ æ­¥å…¥å©šå§»æ®¿å ‚ï¼ä»æ­¤æœ‰äººä¸ä½ å…±æ‹…é£é›¨ã€‚",this.addEffectItem(n,"ğŸ’’","å·²å©š",!0);break;case"have_baby":s="æ­å–œå–œå¾—è´µå­ï¼è™½ç„¶å…»è‚²æˆæœ¬å¢åŠ ï¼Œä½†ç”Ÿæ´»æ›´åŠ å……å®äº†ã€‚",this.addEffectItem(n,"ğŸ‘¶","+1",!0);break;case"buy_car":s="æè½¦æˆåŠŸï¼ä»¥åå‡ºè¡Œæ›´æ–¹ä¾¿äº†ã€‚",this.addEffectItem(n,"ğŸš—","+1",!0);break;case"buy_house":s="è´­æˆ¿æˆåŠŸï¼è™½ç„¶èƒŒä¸Šäº†æˆ¿è´·ï¼Œä½†ç»ˆäºæœ‰äº†è‡ªå·±çš„å®¶ã€‚",this.addEffectItem(n,"ğŸ ","+1",!0);break;case"rest":s="ä¼‘æ¯äº†ä¸€ä¸ªæœˆï¼Œæ„Ÿè§‰ç²¾ç¥çŠ¶æ€å¥½å¤šäº†ã€‚",this.addEffectItem(n,"çœ¼å…‰","+2",!0);break;case"travel":s="æ—…æ¸¸è®©ä½ å¼€é˜”äº†çœ¼ç•Œï¼Œå¯¹ä¸–ç•Œæœ‰äº†æ–°çš„è®¤è¯†ã€‚",this.addEffectItem(n,"çœ¼å…‰","+5",!0);break;case"skip_month":s="å¹³æ·¡çš„ä¸€ä¸ªæœˆè¿‡å»äº†ã€‚";break;default:s="è¡ŒåŠ¨å®Œæˆã€‚"}document.getElementById("event-desc").textContent=s}addEffectItem(t,e,s,n){const a=document.createElement("div");a.className=`effect-item ${n?"effect-positive":"effect-negative"}`,a.textContent=`${e} ${s}`,t.appendChild(a)}async showInvestDialog(t){const s={buy_stock:"è‚¡ç¥¨",buy_fund:"åŸºé‡‘",buy_crypto:"åŠ å¯†è´§å¸"}[t.id]||"æŠ•èµ„",n=prompt(`ç»™è¿™ç¬”${s}æŠ•èµ„èµ·ä¸ªåå­—ï¼š
ï¼ˆå¦‚ï¼šç§‘æŠ€é¾™å¤´è‚¡ã€æ²ªæ·±300åŸºé‡‘ã€æ¯”ç‰¹å¸ç­‰ï¼‰`);if(!n)return!1;const a=prompt(`æŠ•èµ„é‡‘é¢ï¼ˆä¸‡ï¼‰ï¼š
å½“å‰å¯ç”¨ç°é‡‘: ${this.formatMoney(this.player.stats.cash)}`);if(!a)return!1;const o=parseFloat(a)*1e4;return o<=0||o>this.player.stats.cash?(alert("é‡‘é¢æ— æ•ˆæˆ–ç°é‡‘ä¸è¶³"),!1):(this.actionParams={name:n,amount:o},!0)}async showBuyCarDialog(){const t=prompt(`ä¹°è½¦é¢„ç®—ï¼ˆä¸‡ï¼‰ï¼š
å½“å‰å¯ç”¨ç°é‡‘: ${this.formatMoney(this.player.stats.cash)}
å»ºè®®ï¼š10-50ä¸‡`);if(!t)return!1;const e=parseFloat(t)*1e4;if(e<=0||e>this.player.stats.cash)return alert("é‡‘é¢æ— æ•ˆæˆ–ç°é‡‘ä¸è¶³"),!1;const s=prompt("ç»™çˆ±è½¦èµ·ä¸ªåå­—ï¼š")||"æ±½è½¦";return this.actionParams={name:s,price:e},this.player.stats.cash-=e,this.player.buyCar({name:s,price:e}),!0}async showBuyHouseDialog(){const t=prompt(`æˆ¿å±‹æ€»ä»·ï¼ˆä¸‡ï¼‰ï¼š
å½“å‰å¯ç”¨ç°é‡‘: ${this.formatMoney(this.player.stats.cash)}
é¦–ä»˜é€šå¸¸ä¸º30%`);if(!t)return!1;const e=parseFloat(t)*1e4,s=e*.3;if(s>this.player.stats.cash)return alert(`é¦–ä»˜ ${this.formatMoney(s)} è¶…è¿‡å¯ç”¨ç°é‡‘`),!1;const n=prompt("ç»™æˆ¿å­èµ·ä¸ªåå­—ï¼š")||"ä½å®…";this.actionParams={name:n,price:e,downPayment:s,years:30},this.player.stats.cash-=s,this.player.buyHouse({name:n,price:e});const a=e-s;return a>0&&this.player.takeLoan("MORTGAGE",a,30),!0}async showMarryDialog(){const t=prompt(`å©šç¤¼é¢„ç®—ï¼ˆä¸‡ï¼‰ï¼š
å½“å‰å¯ç”¨ç°é‡‘: ${this.formatMoney(this.player.stats.cash)}
å»ºè®®ï¼š15-50ä¸‡`);if(!t)return!1;const e=parseFloat(t)*1e4;if(e<=0||e>this.player.stats.cash)return alert("é‡‘é¢æ— æ•ˆæˆ–ç°é‡‘ä¸è¶³"),!1;const s=prompt(`é…å¶å¹´æ”¶å…¥ï¼ˆä¸‡ï¼‰ï¼š
ï¼ˆä¼šå¢åŠ å®¶åº­æ”¶å…¥ï¼‰`)||"6",n=parseFloat(s)*1e4;return this.actionParams={cost:e,spouseIncome:n},this.player.stats.cash-=e,this.player.marry({income:n}),!0}async showStartBusinessDialog(){const t=prompt(`åˆ›ä¸šæŠ•èµ„é‡‘é¢ï¼ˆä¸‡ï¼‰ï¼š
å½“å‰å¯ç”¨ç°é‡‘: ${this.formatMoney(this.player.stats.cash)}
æ³¨æ„ï¼šåˆ›ä¸šé£é™©é«˜ï¼Œå¯èƒ½è¡€æœ¬æ— å½’ï¼`);if(!t)return!1;const e=parseFloat(t)*1e4;if(e<1e5)return alert("åˆ›ä¸šè‡³å°‘éœ€è¦10ä¸‡å¯åŠ¨èµ„é‡‘"),!1;if(e>this.player.stats.cash)return alert("ç°é‡‘ä¸è¶³"),!1;const s=prompt("ç»™åˆ›ä¸šé¡¹ç›®èµ·ä¸ªåå­—ï¼š")||"åˆ›ä¸šé¡¹ç›®";return this.actionParams={name:s,amount:e},!0}showHoldingsManagement(){const t=document.getElementById("holdings-panel");t&&t.scrollIntoView({behavior:"smooth"}),this.player.holdings.length===0&&alert("ä½ ç›®å‰æ²¡æœ‰ä»»ä½•æŒä»“")}async triggerRandomEvent(){this.isLoading=!0,document.getElementById("choices").innerHTML="",document.getElementById("event-category").textContent="çªå‘äº‹ä»¶",document.getElementById("event-title").textContent="",document.getElementById("event-desc").innerHTML=`
      <div class="loading">
        <div class="loading-spinner"></div>
        <span>å‘ç”Ÿäº†ä¸€äº›äº‹æƒ…...</span>
      </div>
    `;try{const t=await L(this.player);this.currentEvent=t,this.displayRandomEvent(t)}catch(t){console.error("Random event error:",t),this.showActionMenu()}finally{this.isLoading=!1}}displayRandomEvent(t){const e=t.timeMonths>1?`ï¼ˆéœ€${t.timeMonths}ä¸ªæœˆå¤„ç†ï¼‰`:"";document.getElementById("event-category").textContent="ğŸ² "+(t.category||"éšæœºäº‹ä»¶")+e,document.getElementById("event-title").textContent=t.title,document.getElementById("event-desc").textContent=t.description,t.choices&&t.choices.length>0?this.showEventChoices(t):setTimeout(()=>this.showActionMenu(),1500)}showEventChoices(t){const e=document.getElementById("choices");e.innerHTML="",t.choices.forEach(s=>{const n=document.createElement("button");n.className="choice-btn",n.innerHTML=`<div>${s.text}</div>`,n.addEventListener("click",()=>this.selectEventChoice(s)),e.appendChild(n)})}selectEventChoice(t){const e=this.currentEvent.timeMonths||1;this.player.spendTime(e),this.processEventAction(t),this.player.applyEffect(t.effect),this.player.logEvent(this.currentEvent,t),document.getElementById("choices").innerHTML="",this.showEventResult(t),this.updateUI(),setTimeout(()=>{this.showActionMenu()},2e3)}processEventAction(t){var e;if(t.action)switch(t.action){case"marry":this.player.marry({name:"é…å¶",income:Math.floor(this.player.stats.income*.3+Math.random()*5e4)});break;case"baby":this.player.haveBaby();break;case"buy_house":const s=t.loan?t.loan.amount/.7:1e6;this.player.buyHouse({name:"æˆ¿äº§",price:s}),t.loan&&this.player.takeLoan(t.loan.type,t.loan.amount,t.loan.years);break;case"buy_car":const n=Math.abs(((e=t.effect)==null?void 0:e.cash)||2e5);this.player.buyCar({name:"æ±½è½¦",price:n});break;case"buy_investment":if(t.investment){const a=t.investment;t.effect&&t.effect.cash<0&&(t.effect.cash=0),this.player.buyInvestment(a.type,a.name,a.amount)}break}}showEventResult(t){document.getElementById("event-category").textContent="äº‹ä»¶ç»“æœ",t.resultText&&(document.getElementById("event-desc").innerHTML=`<div class="result-text">${t.resultText}</div>`);const e=document.getElementById("effects");if(e.innerHTML="",t.action){const s={marry:"ğŸ’’ ç»“å©šäº†ï¼",baby:"ğŸ‘¶ å–œå¾—è´µå­ï¼",buy_house:"ğŸ  ä¹°æˆ¿äº†ï¼",buy_car:"ğŸš— ä¹°è½¦äº†ï¼",buy_investment:"ğŸ“Š å»ºä»“æˆåŠŸï¼"};s[t.action]&&this.addEffectItem(e,"",s[t.action],!0)}if(t.effect)for(const[s,n]of Object.entries(t.effect)){if(n===0)continue;const a=n>0;let o=s,c=n;s==="cash"||s==="income"?(c=this.formatMoney(Math.abs(n)),c=(n>0?"+":"-")+c):c=(n>0?"+":"")+n,o={cash:"ğŸ’µ ç°é‡‘",income:"ğŸ“ˆ å¹´æ”¶å…¥",insight:"ğŸ‘ï¸ çœ¼å…‰"}[s]||s,this.addEffectItem(e,o,c,a)}}showYearEnd(){document.getElementById("event-category").textContent="å¹´ç»ˆ",document.getElementById("event-title").textContent=`${this.player.age}å²è¿™ä¸€å¹´ç»“æŸäº†`,document.getElementById("event-desc").textContent=`ä»Šå¹´çš„å·¥èµ„å·²æŒ‰æœˆå‘æ”¾å®Œæ¯•ã€‚
ç‚¹å‡»è¿›å…¥ä¸‹ä¸€å¹´ç»§ç»­ä½ çš„æŠ•èµ„ä¹‹æ—…ã€‚`,document.getElementById("choices").innerHTML="",document.getElementById("btn-next-year").style.display="block",this.updateUI()}nextYear(){if(document.getElementById("btn-next-year").style.display="none",document.getElementById("effects").innerHTML="",!this.player.nextYear()){this.gameOver();return}this.updateUI(),this.showActionMenu()}gameOver(){this.showScene("end-scene");const t=this.player.getLifeEvaluation(),e=this.player.calculateLifeScore();document.getElementById("end-subtitle").textContent=`ä» ${this.player.startingAge} å²åˆ° ${this.player.age} å²ï¼Œå…± ${this.player.age-this.player.startingAge} å¹´`;const s=document.getElementById("evaluation-card");s.style.borderColor="#"+t.color.toString(16).padStart(6,"0"),document.getElementById("eval-title").textContent=t.title,document.getElementById("eval-title").style.color="#"+t.color.toString(16).padStart(6,"0"),document.getElementById("eval-desc").textContent=t.description,document.getElementById("eval-score").textContent=`è´¢å¯Œè¯„åˆ†: ${e}`;const n=document.getElementById("final-stats-list");n.innerHTML="";const a=[{label:"ğŸ’° æ€»èµ„äº§",value:this.formatMoney(this.player.stats.wealth),color:"#3fb950"},{label:"ğŸ’µ å¯ç”¨ç°é‡‘",value:this.formatMoney(this.player.stats.cash),color:"#58a6ff"},{label:"ğŸ“ˆ æœ€ç»ˆå¹´æ”¶å…¥",value:this.formatMoney(this.player.stats.income),color:"#a371f7"},{label:"ğŸ‘ï¸ æŠ•èµ„çœ¼å…‰",value:`${this.player.stats.insight}/100`,color:"#f0883e"}];if(this.player.life.married&&a.push({label:"ğŸ’’ å©šå§»",value:"å·²å©š",color:"#f778ba"}),this.player.life.children>0&&a.push({label:"ğŸ‘¶ å­å¥³",value:`${this.player.life.children}ä¸ª`,color:"#f778ba"}),this.player.life.houses.length>0){const h=this.player.life.houses.reduce((u,f)=>u+f.currentValue,0);a.push({label:"ğŸ  æˆ¿äº§",value:`${this.player.life.houses.length}å¥— (${this.formatMoney(h)})`,color:"#7ee787"})}this.player.life.cars.length>0&&a.push({label:"ğŸš— è½¦è¾†",value:`${this.player.life.cars.length}è¾†`,color:"#79c0ff"});const o=this.player.getTopSkill();if(o.level>0){const h={stock:"è‚¡ç¥¨",fund:"åŸºé‡‘",real_estate:"æˆ¿äº§",crypto:"åŠ å¯†è´§å¸",business:"åˆ›ä¸š",career:"èŒåœº"};a.push({label:"ğŸ¯ æœ€å¼ºé¢†åŸŸ",value:`${h[o.field]} Lv.${o.level}`,color:"#ffd700"})}a.forEach(h=>{const u=document.createElement("div");u.className="final-stat",u.style.color=h.color,u.textContent=`${h.label}: ${h.value}`,n.appendChild(u)});const c=document.createElement("div");c.className="final-stat",c.style.color="#8b949e";const l=this.player.stats.wealth-this.player.startingWealth,r=l>=0?`+${this.formatMoney(l)}`:this.formatMoney(l);c.textContent=`ğŸ“Š è´¢å¯Œå¢é•¿: ${r}ï¼ˆèµ·ç‚¹: ${this.formatMoney(this.player.startingWealth)}ï¼‰`,n.appendChild(c);const d=document.getElementById("life-log-list");d.innerHTML="",this.player.lifeLog.slice(-10).forEach(h=>{const u=document.createElement("div");u.className="log-item",u.textContent=`${h.age}å²${h.month}æœˆ - ${h.event}: ${h.choice}`,d.appendChild(u)})}}new H;
